<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Name Novel</title>
    <link rel="icon" href="https://lh3.google.com/u/1/d/1btktrYFS3By6IBlJWjCJ6SJnSm706KrQ=w1876-h972-iv1">

    <style>
       
        /*Header*/
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            padding: 10px;
            background-image: url("https://img.freepik.com/free-vector/white-abstract-background_23-2148809724.jpg");
        }

        header img {
            width: 100%;
            height: auto;
        }

        header a{text-decoration: none;color:azure;display: block;}

        header .home-logo {
            width: 70px;
            height: 30px;
            padding: 15px;
        }
        header .logo, 
        header .right-logo {
            width: 20px;
            height: 20px;
            background-color: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        header .right-logo img{
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        header h1 {
            margin: 10px 0;
        }

        nav {
            background-color: rgb(46, 46, 46);
            color: white;
            padding: 10px 0;
        }

        nav ul {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        nav ul li {
            margin: 5px 0;
            margin-left: auto;
            margin-right: auto;
        }

        nav ul li a {
            text-decoration: none;
            color: whitesmoke;
            font-size: 8px;
        }

        .dropdown {
            position: relative;
            text-align: center;
        }

        .dropbtn {
            font-size: 8px;
            border: none;
            background-color: transparent;
            color: whitesmoke;
            cursor: pointer;
            padding: 5px;
        }

        .dropcontent {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            text-align: center;
            min-width: 50px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 4;
            width: 150px;
        }

        .dropcontent a {
            color: black;
            padding: 10px;
            display: block;
            text-decoration: none;
        }

        .dropcontent a:hover {
            background-color: gray;
            color: #ddd;
        }

        .show {
            display: flex;
            flex-wrap: wrap;
            justify-content: start; 
            gap: 12px; 
        }

        .show > * { 
            flex: 0 1 calc(20% - 10px);
            box-sizing: border-box; 
        }

        .find {
            position: relative;
            display: inline-block;
            height: 30px;
        }

        .find input {
            width: 125px;
            padding: 10px 0 10px 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
            height: 100%;
            font-size: 10px;
            transition: width 0.4s ease, padding 0.4s ease, opacity 0.4s ease;
            overflow: hidden;
        }

        .find.expanded input {
            width: 225px;
            padding: 10px 35px 10px 10px;
            opacity: 1;
        }

        .find .icon {
            position: absolute;
            top: 50%;
            right: auto;
            left: 100px;
            transform: translateY(-50%);
            color: #000000;
            cursor: pointer;
            opacity: 1;
            pointer-events: auto;
            transition: opacity 0.2s ease, color 0.4s ease, left 0.4s ease, right 0.4s ease;
        }

        .find .icon.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .find .icon.reappear {
            left: auto;
            right: -10px;
            color: #000000;
            opacity: 1;
        }

        .find .icon:hover {
            color: #00ffea;
        }

        .logo {margin-left: 2%;}
        .right-logo {
            margin-right: 2%;
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .right-logo:hover .account-dropdown {
            display: block;
        }

        main {
            display: flex;
            flex-direction: row;
            background-image: url(https://img.freepik.com/free-vector/gradient-abstract-wireframe-background_23-2149009903.jpg?semt=ais_hybrid&w=740);
            background-size: cover;
            height: auto;
        }

        /*main content*/
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        .up-stories {
            background-color: rgba(157, 255, 234, 0.76);
            padding: 20px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
        }
        .up-stories h2 {
            margin-bottom: 20px;
            padding: 10px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.8);
            border: #000000 1px solid;
            border-radius: 10px;
        }
        .up-stories form {
            padding: 15px;
            border: #000000 1px solid;
            border-radius: 10px;
            gap: 10px;
            background-color: rgba(230, 230, 230, 0.8);
        }
        .up-stories form input {
            padding: 10px;
            width: 70%;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .up-stories form select {
            padding: 10px;
            width: 40%;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .up-stories form label {
            font-size: 14px;
            margin-bottom: 5px;
            display: block;
        }

        .up-stories-genre {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 27px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
        }

        .up-stories-genre input[type="checkbox"] {
            width: 25px;
            padding: 0;
            margin: 0;
        }

        .up-stories-genre label {
            font-size: 18px;
            width: 150px;
        }

        .up-stories button {
            display: flex;
            justify-self: center;
            justify-content: center;
            background-color: #8caf4c;
            color: white;
            width: 40%;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /*up image*/
        .upload-image-wrapper {
            width: 200px;
            height: 100%;
            border: 2px dashed #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .upload-image-wrapper input[type="file"] {
            display: none;
        }

        .upload-image-wrapper img {
            max-width:100%;
            max-height: 100%;
            opacity: 0.5;
        }

        .upload-preview {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }
        
        /*chia 2 form*/
        #left-form, #right-form {
            width: 50%;
        }
        #right-form {
            display: flex;
            flex-wrap: wrap;
        }
        #right-form label {
            width: 100%;
            text-align: left;
        }
        #right-form .upload-image-wrapper {
            margin: auto;
        }

        /*story list*/
        .story-list {
            display: flex;
            width: 100%;
            height: auto;
            justify-content: center;
        }
        .story-upload-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            gap: 10px;
            padding: 20px;
            height: 100%;
            border-radius: 0 0 10px 10px;
            background-color: rgba(157, 255, 234, 0.76);
        }
        .story-upload-content {
            width: 100%;
            height: auto;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 11px;
        }
        .story-upload-content h1 {
            text-align: center;
            font-size: 24px;
            background-color: #ffffff;
            border-radius: 10px;
            border: #000000 1px solid;
            padding: 10px;
        }
        .story-upload-content img {
            max-width: 100px;
            height: auto;
        }
        .story-upload-list {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            max-width: 100%;
            max-height: 5472px;
            background-color: #ffffffd7;
            padding: 10px;
            border-radius: 10px;
            border: #000000 1px solid;
        }
        .story-card {
            flex: 0 1 124px;
            height: 300px;
            border: 0px solid transparent;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
            text-align: center;
        }

        .story-card:hover {
            box-shadow: 0 2px 18px #72efff;
            cursor: pointer;
            transform: scale(1.02) translateY(-2px);
        }

        .story-card img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 15px 15px 0 0 ;
        }

        .story-card a {
            display: block;
            text-align: center;
            text-decoration: none;
            color: black;
        }

        /*foot-content*/
        footer {
            text-align: center;
            padding: 10px;
            background-color: #1b1b1be8;
            border-top: 1px solid #ddd;
            color: white;
        }
        .tothetop button {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            width: 45px;
            border: 1px solid #000000;
            outline: none;
            background-color: rgba(255, 255, 255, 0.096);
            color: rgb(0, 255, 242);
            cursor: pointer;
            padding: 15px;
            border-radius: 8px;
        }

        /* Desktop View */
        @media (min-width: 768px) {
            main {
                gap: 10px; 
                padding: 10px;
            }

            header {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
            }

            header img{
                display: flex;
                margin-left: auto;
                margin-right: auto;
                width: 100%;
            }
            
            header .home-logo {
                width: 330px;
                height: 120px;
                padding: 15px;
            }

            header .logo,
            header .right-logo {
                width: 50px;
                height: 50px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            nav ul {
                flex-direction: row;
                justify-content: center;
                list-style: none;
                padding: 10px;
                margin: 0;
                margin-left: 125px;
            }
            nav ul li {
                margin: 0 15px;
            }
            nav ul li a{
                font-size: 16px;
            }

            .dropdown {
                position: relative;
                display: inline-block;
            }

            .dropcontent {
                width: 700px;
                margin-left: -170px;
                min-width: 120px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            }

            .dropbtn{font-size: 16px;}
            .find{width: 200px;}
            .find input{font-size: 16px;}

            .up-stories {
                width: 60%;
            }

            .up-stories h2 {
                font-size: 24px;
            }

            .up-stories form input {
                width: 368px;
            }

            .up-stories form select {
                width: 390px;
            }

            .story-upload-container {
                width: 60%;
            }
            .story-card{
                flex: 0 1 210px;
                height: 450px;
            }
            .story-card a {
                font-size: 16px;
            }
            .story-card p {
                font-size: 14px;
            }
        }
    </style>
</head>
    <body>
    <header>
        <a class="logo" href="home.html"><img src="https://i.postimg.cc/B66gbNSH/HUB-1.png" width="50px" height="50px" alt=""></a>
        <a href="home.html" class="home-logo"><img src="https://i.postimg.cc/bvLgq4hq/logo-web-novel-Canvases-Landscape-i1.png" alt=""></a>
        <div class="right-logo" onclick="redirectToAccount()">
            <img class="profile-pic" src="default-profile.png" alt="Profile Picture">
        </div>   
    </header>
    <nav>
        <ul>
            <li><a href="home.html">Trang Chủ</a></li>
            <li class="dropdown">
                <button onclick="toggleDropdown()" class="dropbtn">Thể Loại</button>
                <div id="myDropdown" class="dropcontent">
                    <a href="#" onclick="redirectToGenre('all')">Tất cả thể loại</a>
                    <a href="#" onclick="redirectToGenre('Hành Động')">Hành Động</a>
                    <a href="#" onclick="redirectToGenre('Lãng Mạn')">Lãng Mạn</a>
                    <a href="#" onclick="redirectToGenre('Hài Hước')">Hài Hước</a>
                    <a href="#" onclick="redirectToGenre('Giả Tưởng')">Giả Tưởng</a>
                    <a href="#" onclick="redirectToGenre('Võ Thuật')">Võ Thuật</a>
                    <a href="#" onclick="redirectToGenre('Phiêu Lưu')">Phiêu Lưu</a>
                    <a href="#" onclick="redirectToGenre('Hậu Cung')">Hậu Cung</a>
                    <a href="#" onclick="redirectToGenre('Manga')">Manga</a>
                    <a href="#" onclick="redirectToGenre('Manhua')">Manhua</a>
                    <a href="#" onclick="redirectToGenre('Manhwa')">Manhwa</a>
                    <a href="#" onclick="redirectToGenre('Kinh dị')">Kinh dị</a>
                    <a href="#" onclick="redirectToGenre('Huyền Huyễn')">Huyền Huyễn</a>
                    <a href="#" onclick="redirectToGenre('Trinh Thám')">Trinh Thám</a>
                    <a href="#" onclick="redirectToGenre('Lịch Sử')">Lịch Sử</a>
                    <a href="#" onclick="redirectToGenre('Khoa học')">Khoa học</a>
                    <a href="#" onclick="redirectToGenre('Viễn Tưởng')">Viễn Tưởng</a>
                    <a href="#" onclick="redirectToGenre('Siêu nhiên')">Siêu nhiên</a>
                    <a href="#" onclick="redirectToGenre('Tu Tiên')">Tu Tiên</a>
                    <a href="#" onclick="redirectToGenre('Hentai')">Hentai</a>
                    <a href="#" onclick="redirectToGenre('Doujinshi')">Doujinshi</a>
                    <a href="#" onclick="redirectToGenre('Webtoon')">Webtoon</a>
                    <a href="#" onclick="redirectToGenre('Đời Thường')">Đời Thường</a>
                    <a href="#" onclick="redirectToGenre('Fantasy')">Fantasy</a>
                </div>
            </li>
            <li><a href="Follow.html">Theo Dõi</a></li>
            <li><a href="writestory.html">Up Truyện</a></li>
            <li>
                <div class="find" id="search-container">
                  <input type="text" id="search-input" placeholder="Tìm Truyện">
                  <span class="icon" id="search-button">
                    <i class="fa-solid fa-magnifying-glass"></i>
                  </span>
                </div>
            </li> 
        </ul>
    </nav>
    <main style="padding: 20px; font-family: sans-serif;">
        <div class="container">
            <section class="up-stories">
                <h2>Thêm Truyện Mới</h2>
                <form id="addStoryForm">
                    <div id="form-wrapper" style="display: flex; gap: 10px;">
                        <div id="left-form">
                            <label for="storyId">ID truyện:</label>
                            <input type="text" id="storyId" placeholder="ID truyện (_id) ..." required /><br><br>
            
                            <label for="title">Tên truyện:</label>
                            <input type="text" id="title" placeholder="Tên truyện ... " required /><br><br>
            
                            <label for="author">Tác giả:</label>
                            <input type="text" id="author" placeholder="Tác giả ... " required /><br><br>
                        </div>
            
                        <div id="right-form">
                            <label for="image">Hình ảnh:</label>
                            <div class="upload-image-wrapper" id="uploadBox">
                                <img src="/path/to/plus-icon.png" id="previewIcon" alt="+" />
                                <input type="file" id="image" accept="image/*">
                            </div><br><br>
                        </div>
                    </div>
            
                    <label for="status">Tình trạng:</label>
                    <select id="status" required>
                        <option value="">-- Chọn tình trạng --</option>
                        <option value="Đang Cập Nhật">Đang Cập Nhật</option>
                        <option value="Đang Tạm Ngưng">Đang Tạm Ngưng</option>
                        <option value="Đã Hoàn Thành">Đã Hoàn Thành</option>
                    </select><br><br>
            
                    <label>Thể loại:</label>
                    <div class="up-stories-genre" id="genre"></div><br><br>
            
                    <button type="submit">Thêm Truyện</button>
                </form>
            </section>            
        
            <section class="story-list">
                <div class="story-upload-container">
                    <div class="story-upload-content">
                        <h1>Truyện đã tải lên</h1>
                        <div class="story-upload-list"></div>
                    </div>
                </div>
            </section>            
        </div>              
    </main>      
    <footer>
        <div class="tothetop">
            <button onclick="scrollToTop()" id="myBtn" title="Go to top"><i class="fa fa-angle-up" aria-hidden="true"></i></button>
        </div>
        <p>&copy; 2025 Truyện Tranh Online. All Rights Reserved.</p>
    </footer>

    <script src="https://kit.fontawesome.com/508b433abc.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
        // Toggle search input expansion
        const searchContainer = document.getElementById('search-container');
        const searchButton = document.getElementById('search-button');
        const input = document.getElementById('search-input');

        // Track expanded state
        let isExpanded = false;

        searchButton.addEventListener('click', () => {
            searchButton.classList.add('hidden');

            if (!isExpanded) {
                searchContainer.classList.add('expanded');

                setTimeout(() => {
                    searchButton.classList.remove('hidden');
                    searchButton.classList.add('reappear');
                    input.focus();
                }, 500);

                isExpanded = true;
            } else {
                searchContainer.classList.remove('expanded');
                input.value = '';

                setTimeout(() => {
                    searchButton.classList.remove('hidden');
                    searchButton.classList.remove('reappear');
                }, 200);

                isExpanded = false;
            }
        });
        //preview image
        const imageInput = document.getElementById("image");
        const uploadBox = document.getElementById("uploadBox");
        const previewIcon = document.getElementById("previewIcon");

        uploadBox.addEventListener("click", () => imageInput.click());

        imageInput.addEventListener("change", () => {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewIcon.src = e.target.result;
                    previewIcon.classList.add("upload-preview");
                };
                reader.readAsDataURL(file);
            }
        });

         // Danh sách thể loại
        const genres = [
            "Hành Động", "Lãng Mạn", "Hài Hước", "Giả Tưởng", "Võ Thuật", "Phiêu Lưu",
            "Hậu Cung", "Manga", "Manhua", "Manhwa", "Kinh dị", "Huyền Huyễn", "Trinh Thám",
            "Lịch Sử", "Khoa học", "Viễn Tưởng", "Siêu nhiên", "Tu Tiên", "Hentai", "Doujinshi",
            "Webtoon", "Đời Thường", "Fantasy"
        ];

        // Đổ checkbox thể loại vào div#genre
        const genreContainer = document.getElementById("genre");
        genres.forEach(g => {
            const label = document.createElement("label");
            label.innerHTML = `<input type="checkbox" name="genre" value="${g}"> ${g}`;
            genreContainer.appendChild(label);
        });

        $(window).scroll(function() {
            if ($(document).scrollTop() > 100) {
                $("#myBtn").show();
            } else {
                $("#myBtn").hide();
            }
        });
        function scrollToTop() {
            $("html, body").animate({scrollTop: 0}, 700);
        }

        //load upload story
        document.addEventListener("DOMContentLoaded", async () => {
            const uploadListContainer = document.querySelector(".story-upload-list");
            uploadListContainer.innerHTML = "<p>Đang tải...</p>";

            try {
                // Get logged-in user data
                const storedData = JSON.parse(sessionStorage.getItem("loggedInUser"));
                if (!storedData || !storedData.user || !storedData.user.userId) {
                    uploadListContainer.innerHTML = "<p>Vui lòng đăng nhập để xem truyện đã tải lên.</p>";
                    return;
                }

                const userId = storedData.user.userId;

                // Fetch uploaded stories from custom API
                const response = await fetch(`http://localhost:3000/user-stories/${userId}`);
                if (!response.ok) throw new Error("Không thể lấy danh sách truyện đã tải lên");

                const uploadedStories = await response.json();

                if (uploadedStories.length === 0) {
                    uploadListContainer.innerHTML = "<p>Chưa có truyện nào được tải lên.</p>";
                    return;
                }

                uploadListContainer.innerHTML = "";

                uploadedStories.forEach(story => {
                    const storyCard = document.createElement("div");
                    storyCard.classList.add("story-card");

                    storyCard.dataset.theloai = JSON.stringify(story.genre);
                    storyCard.dataset.status = story.status;
                    storyCard.dataset.views = story.views;
                    storyCard.dataset.chapters = Object.keys(story.chapters || {}).length;

                    storyCard.innerHTML = `
                        <a href="#" onclick='redirectToStoryEditPage(${JSON.stringify(story)})'>
                            <img src="${story.image}" alt="${story.title}">
                        </a>
                        <div class="story-info">
                            <h3><a href="#" onclick='redirectToStoryEditPage(${JSON.stringify(story)})'>${story.title}</a></h3>
                            <p><strong>Chapters:</strong> ${Object.keys(story.chapters || {}).length}</p>
                            <p><strong>Lượt Xem:</strong> ${story.views}</p>
                            <p><strong>Theo Dõi:</strong> ${story.followers}</p>
                        </div>
                    `;

                    uploadListContainer.appendChild(storyCard);
                });

            } catch (error) {
                console.error("❌ Lỗi khi tải truyện đã upload:", error);
                uploadListContainer.innerHTML = "<p>Không thể tải dữ liệu.</p>";
            }
        });

        //search story
        document.addEventListener("DOMContentLoaded", () => {
            const searchInput = document.getElementById("search-input");
            const searchButton = document.getElementById("search-button");

            function handleSearch() {
                const searchTerm = searchInput.value.trim();
                if (searchTerm) {
                    window.location.href = `genre.html?search=${encodeURIComponent(searchTerm)}`;
                }
            }

            searchButton.addEventListener("click", handleSearch);
            searchInput.addEventListener("keypress", (event) => {
                if (event.key === "Enter") {
                    handleSearch();
                }
            });
        });
        function redirectToGenre(genre) {
            window.location.href = `genre.html?theloai=${encodeURIComponent(genre)}`;
        }

        function toggleDropdown() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        // Đóng dropdown khi click ngoài
        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn')) {
                document.getElementById("myDropdown").classList.remove("show");
            }
        };

        async function redirectToAccount() {
            try {
                const response = await fetch("/api/check-login", {
                    method: "GET",
                    headers: {
                        "Authorization": localStorage.getItem("sessionId") || ""
                    }
                });

                const data = await response.json();
                if (data.loggedIn) {
                    window.location.href = "account.html";
                } else {
                    window.location.href = "account.html?mode=signin";
                }
            } catch (error) {
                console.error("Lỗi kiểm tra đăng nhập:", error);
                window.location.href = "account.html?mode=signin";
            }
        }

        function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
        }

        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn')) {
                const dropdowns = document.getElementsByClassName("dropcontent");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        };

        function redirectToStoryEditPage(story) {
            console.log("📌 Chuyển hướng với id:", story._id);
            window.location.href = `EditNovel.html?story=${encodeURIComponent(story._id)}`;
        }

        // Load profile pictures
        function loadProfilePictures() {
            let user = JSON.parse(localStorage.getItem('loggedInUser'));
            if (user && user.profilePic) {
                document.querySelectorAll(".profile-pic").forEach(img => {
                    img.src = user.profilePic;
                });
            }
        }

        document.addEventListener("DOMContentLoaded", loadProfilePictures);

        // Add story
        const storedData = JSON.parse(sessionStorage.getItem("loggedInUser"));
        const followedListContainer = document.getElementById("storyList"); // thêm phòng trường hợp chưa định nghĩa

        if (!storedData || !storedData.user || !storedData.user.userId) {
            followedListContainer.innerHTML = "<p>Vui lòng đăng nhập để xem danh sách truyện theo dõi.</p>";
            throw new Error("Chưa đăng nhập");
        }

        const userId = storedData.user.userId;
        console.log("User ID:", userId);

        document.getElementById("addStoryForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            // Lấy các thể loại được chọn từ checkbox
            const genreCheckboxes = document.querySelectorAll('input[name="genre"]:checked');
            const selectedGenres = Array.from(genreCheckboxes).map(cb => cb.value);

            const data = {
                _id: document.getElementById("storyId").value.trim(),
                title: document.getElementById("title").value.trim(),
                author: document.getElementById("author").value.trim(),
                status: document.getElementById("status").value || "Đang Cập Nhật",
                genre: selectedGenres,
                userId: userId
            };

            try {
                const res = await fetch("/add-story", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await res.json();
                alert(result.message);

                if (result.success) {
                    fetchUserStories(userId);
                }
            } catch (err) {
                console.error("Lỗi khi thêm truyện:", err);
                alert("Lỗi khi thêm truyện. Vui lòng thử lại.");
            }
        });

    </script>
</body>
</html>